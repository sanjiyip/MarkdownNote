# 4.2 æ‰§è¡Œç¯å¢ƒ
-----
## æ‰§è¡Œç¯å¢ƒ
**æ‰§è¡Œç¯å¢ƒ**ï¼ˆExecution Context,ä¹Ÿå«**æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡å¯ä»¥ç†è§£ä¸ºå‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒï¼Œæ¯ä¸€ä¸ªå‡½æ•°æ‰§è¡Œæ—¶ï¼Œéƒ½ä¼šç»™å¯¹åº”çš„å‡½æ•°åˆ›å»ºè¿™æ ·ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒã€‚ç®€ç§°**ç¯å¢ƒ**ï¼‰æ˜¯JavaScriptä¸­æœ€ä¸ºé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚

**æ‰§è¡Œç¯å¢ƒå®šä¹‰äº†å˜é‡å’Œå‡½æ•°æœ‰æƒè®¿é—®çš„å…¶ä»–æ•°æ®**ï¼Œå†³å®šäº†ä»–ä»¬å„è‡ªçš„è¡Œä¸ºã€‚æ¯ä¸ªæ‰§è¡Œç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„**å˜é‡å¯¹è±¡**ï¼ˆvariable objectï¼‰ï¼Œç¯å¢ƒä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½ä¿å­˜åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ã€‚

- **å…¨å±€æ‰§è¡Œç¯å¢ƒ**æ˜¯æœ€å¤–å›´çš„ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œæœ‰æ—¶å€™è¢«å«**å…¨å±€ç¯å¢ƒ**ã€‚åœ¨Webæµè§ˆå™¨ä¸­ï¼Œå…¨å±€æ‰§è¡Œç¯å¢ƒè¢«è®¤ä¸ºæ˜¯windowå¯¹è±¡ï¼Œå› æ­¤æ‰€æœ‰å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½æ˜¯ä½œä¸ºwindowå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•åˆ›å»ºçš„ã€‚æŸä¸ªæ‰§è¡Œç¯å¢ƒä¸­çš„æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥ç¯å¢ƒè¢«é”€æ¯ï¼Œä¿å­˜å…¶ä¸­çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°å®šä¹‰ä¹Ÿéšä¹‹é”€æ¯ã€‚ï¼ˆå…¨å±€æ‰§è¡Œç¯å¢ƒç›´è‡³åº”ç”¨ç¨‹åºé€€å‡ºæ—¶æ‰ä¼šè¢«é”€æ¯â€”â€”ä¾‹å¦‚å…³é—­ç½‘é¡µæˆ–è€…æµè§ˆå™¨ï¼‰

- **å‡½æ•°æ‰§è¡Œç¯å¢ƒ**ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œç¯å¢ƒã€‚å½“æ‰§è¡Œæµè¿›å…¥ä¸€ä¸ªå‡½æ•°æ—¶ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼‰ï¼Œå‡½æ•°çš„ç¯å¢ƒå°±ä¼šè¢«æ¨å…¥ä¸€ä¸ª**ç¯å¢ƒæ ˆ**ä¸­ã€‚è€Œåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ ˆå°†å…¶ç¯å¢ƒå¼¹å‡ºï¼ŒæŠŠæ§åˆ¶æƒè¿”å›ç»™ä¹‹å‰çš„æ‰§è¡Œç¯å¢ƒã€‚(æœ‰çš„æ—¶å€™ï¼Œå‡½æ•°æ‰§è¡Œç¯å¢ƒå«**å±€éƒ¨ç¯å¢ƒ**)ã€‚

- å½“ä»£ç åœ¨ä¸€ä¸ªç¯å¢ƒ(ä¸Šä¸‹æ–‡ï¼‰ä¸­æ‰§è¡Œï¼Œä¼šåˆ›å»ºå˜é‡å¯¹è±¡çš„ä¸€ä¸ª**ä½œç”¨åŸŸé“¾**ï¼ˆscope chainï¼‰ã€‚ä½œç”¨åŸŸé“¾çš„ç”¨é€”ï¼Œæ˜¯ä¿è¯å¯¹æ‰§è¡Œç¯å¢ƒæœ‰æƒè®¿é—®çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°çš„æœ‰åºè®¿é—®ã€‚
```js
var color = 'blue';

function changeColor() {
    var anotherColor = 'red';

    function swapColors() {
        var tempColor = anotherColor;
        anotherColor = color;
        color = tempColor;
    }

    swapColors();
}

changeColor();
```
![ä¾‹å­ä¸­çš„æ‰§è¡Œç¯å¢ƒç¤ºæ„å›¾](images/4.2-1.png) 
ä¾‹å­æ¥æºï¼š[å‰ç«¯åŸºç¡€è¿›é˜¶ï¼ˆäºŒï¼‰ï¼šæ‰§è¡Œä¸Šä¸‹æ–‡è¯¦ç»†å›¾è§£](http://www.jianshu.com/p/a6d37c77e8db)

è¯¦ç»†äº†è§£äº†è¿™ä¸ªè¿‡ç¨‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ‰§è¡Œä¸Šä¸‹æ–‡æ€»ç»“ä¸€äº›ç»“è®ºäº†:
- å•çº¿ç¨‹
- åŒæ­¥æ‰§è¡Œï¼Œåªæœ‰æ ˆé¡¶çš„ä¸Šä¸‹æ–‡å¤„äºæ‰§è¡Œä¸­ï¼Œå…¶ä»–ä¸Šä¸‹æ–‡éœ€è¦ç­‰å¾…
- å…¨å±€ä¸Šä¸‹æ–‡åªæœ‰å”¯ä¸€çš„ä¸€ä¸ªï¼Œå®ƒåœ¨æµè§ˆå™¨å…³é—­æ—¶å‡ºæ ˆ
- å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸ªæ•°æ²¡æœ‰é™åˆ¶
- æ¯æ¬¡æŸä¸ªå‡½æ•°è¢«è°ƒç”¨ï¼Œå°±ä¼šæœ‰ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸ºå…¶åˆ›å»ºï¼Œå³ä½¿æ˜¯è°ƒç”¨çš„è‡ªèº«å‡½æ•°ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚

----

## åˆ›å»ºæ‰§è¡Œç¯å¢ƒ
> å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼ˆæ¿€æ´»ï¼‰ï¼Œä¸€ä¸ªæ–°çš„æ‰§è¡Œç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰å°±ä¼šè¢«åˆ›å»ºã€‚åˆ›å»ºæ‰§è¡Œç¯å¢ƒçš„ä¸¤ä¸ªé˜¶æ®µï¼š

è‹±æ–‡ç‰ˆè§£é‡Šï¼š
- Execution Context in Detail
So we now know that everytime a function is called, a new execution context is created. However, inside the JavaScript interpreter, **every call to an execution context has 2 stages:**ï¼ˆæ¯æ¬¡è°ƒç”¨å‡½æ•°ï¼Œæ‰§è¡Œç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰éƒ½ä¼šè¢«åˆ›é€ å‡ºæ¥ï¼Œç„¶ååˆ›é€ è¿‡ç¨‹æœ‰2é˜¶æ®µï¼š**åˆ›å»ºé˜¶æ®µ**å’Œæ‰§è¡Œé˜¶æ®µï¼‰

    - **Creation Stage** [when the function is called, but before it executes any code inside(è¿™é˜¶æ®µæ˜¯æŒ‡**å½“å‡½æ•°å·²ç»è¢«å¼€å§‹è¢«è°ƒç”¨call**ï¼Œä½†**å‡½æ•°é‡Œé¢çš„ä»£ç è¿˜æ²¡å¼€å§‹æ‰§è¡Œä¹‹å‰**ï¼Œå‘ç”Ÿä»¥ä¸‹äº‹æƒ…)]:
        - Create the Scope Chain. 
          åˆ›å»ºä½œç”¨åŸŸé“¾

        - Create variables, functions and arguments. 
          åˆ›å»ºå˜é‡ã€å‡½æ•°å’Œå‚æ•°ï¼ˆä¹Ÿå«åˆ›å»ºå˜é‡å¯¹è±¡ï¼Ÿï¼Ÿï¼‰

        - Determine the value of `this`. 
          ç¡®å®šthisçš„æŒ‡å‘

    - **Activation / Code Execution Stage**:
        - Assign values, references to functions and interpret / execute code.

It is possible to represent each execution context conceptually as an object with 3 properties:

```js
executionContextObj = {
    'scopeChain': { /* variableObject + all parent execution context's variableObject */ },
    'variableObject': { /* function arguments / parameters, inner variable and function declarations */ },
    'this': {}
}
```

---

### **Here is a pseudo-overview of how the interpreter evaluates the code:**
how the JavaScript interpreter is evaluating your code?**è¿™é‡Œè§£é‡Šæµè§ˆå™¨è§£æJavaScriptä»£ç çš„è¿‡ç¨‹4æ­¥èµ°ï¼Œåé¢ä¸¤æ­¥è‡³å…³é‡è¦**
- Find some code to invoke a function.

    æ‰¾åˆ°å…·æœ‰è°ƒç”¨å‡½æ•°åŠŸèƒ½çš„ç¬¦å·â€”â€”**`();`**

- Before executing the function code, create the  execution context.

    åœ¨å¼€å§‹æ‰§è¡Œå…·æœ‰`();`çš„å‡½æ•°ä»£ç ä¹‹å‰ï¼Œåˆ›å»ºä¸€ä¸ª**æ‰§è¡Œç¯å¢ƒ**ã€‚

- **Enter the creation stage:** **æ‰§è¡Œç¯å¢ƒ-åˆ›å»ºé˜¶æ®µ**
    - Initialize the Scope Chain. **å»ºç«‹ä½œç”¨åŸŸé“¾**

    - Create the variable object: **åˆ›å»ºå˜é‡å¯¹è±¡** ï¼ˆ3æ­¥â€”â€”éå¸¸é‡è¦ï¼‰
    
        1. Create the arguments object, check the context for parameters, initialize the name and value and create a reference copy.
        
            **å»ºç«‹argumentså¯¹è±¡**ã€‚
            æ£€æŸ¥å½“å‰æ‰§è¡Œç¯å¢ƒä¸­çš„å‚æ•°ï¼Œå¹¶å»ºç«‹å‚æ•°å¯¹è±¡çš„å±æ€§ä¸å±æ€§å€¼ã€‚

        2. Scan the context for function declarations:
            
            æ£€æŸ¥å½“å‰æ‰§è¡Œç¯å¢ƒçš„**å‡½æ•°å£°æ˜**

            - For each function found, create a property in the  variable object that is the exact function name, which has a reference pointer to the function in memory.
            
                æ¯æ‰¾åˆ°ä¸€ä¸ªä»¥ **`function`å…³é”®å­—å£°æ˜** çš„å‡½æ•°åï¼ˆå³é€šè¿‡**å‡½æ•°å£°æ˜**è¯­æ³•å®šä¹‰çš„å‡½æ•°ï¼‰ã€‚å°±åœ¨å˜é‡å¯¹è±¡ä¸­ï¼Œç”¨å‡½æ•°åå»ºç«‹ä¸€ä¸ª`å˜é‡å¯¹è±¡`çš„å±æ€§ï¼Œå±æ€§å€¼ä¸ºæŒ‡å‘è¯¥å‡½æ•°ï¼ˆå¯¹è±¡ï¼‰æ‰€åœ¨å †å†…å­˜åœ°å€çš„å¼•ç”¨ã€‚
            
            - If the function name exists already, the reference pointer value will be overwritten.
            
                å¦‚æœè¯¥å‡½æ•°åå·²ç»å­˜åœ¨(å³é‡å¤ä¸¤ä¸ªç›¸åŒçš„å‡½æ•°åï¼Œæˆ–è€…æ˜¯å˜é‡åå’Œå‡½æ•°åç›¸åŒ)ï¼Œé‚£ä¹ˆè¯¥**å˜é‡å¯¹è±¡å±æ€§å€¼**å°†ä¼šè¢«æ–°çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆåœ°å€ï¼‰æ‰€è¦†ç›–ï¼ˆå³è¢«åé¢å®šä¹‰çš„å‡½æ•°çš„å¼•ç”¨è¦†ç›–ï¼‰ã€‚
                

        3. Scan the context for variable declarations:
       
            æ£€æŸ¥å½“å‰æ‰§è¡Œç¯å¢ƒä¸­çš„**å˜é‡å£°æ˜**
            - For each variable declaration found, create a property in the variable object that is the variable name, and initialize the value as undefined.
            
                æ¯æ‰¾åˆ°ä¸€ä¸ªä»¥ **`var`å…³é”®å­—å£°æ˜** çš„å˜é‡ï¼Œå°±åœ¨`å˜é‡å¯¹è±¡`ä¸­ä»¥varå£°æ˜çš„å˜é‡åå»ºç«‹ä¸€ä¸ªå±æ€§ï¼Œå±æ€§å€¼ä¸ºundefinedã€‚

            - If the variable name already exists in the  variable object, do nothing and continue scanning.
           
                å¦‚æœè¯¥å˜é‡åçš„å±æ€§å·²ç»å­˜åœ¨ï¼Œä¸ºäº†é˜²æ­¢åŒåçš„å‡½æ•°è¢«ä¿®æ”¹ä¸ºundefinedï¼Œåˆ™ä¼šç›´æ¥è·³è¿‡ï¼ŒåŸå˜é‡å¯¹è±¡çš„å±æ€§å€¼ä¸ä¼šè¢«ä¿®æ”¹ï¼Œç»§ç»­æŸ¥æ‰¾å…¶ä»–å˜é‡å£°æ˜ã€‚(varå£°æ˜çš„å˜é‡å½“é‡åˆ°åŒåçš„å±æ€§æ—¶ï¼Œä¼šè·³è¿‡è€Œä¸ä¼šè¦†ç›–ã€‚è¿™æƒ…å†µä»…å¯¹äºåœ¨åŒä¸€ä¸ªå‡½æ•°ç¯å¢ƒä¸‹)


        ![æ‰§è¡Œä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸ](images/å˜é‡å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹.png) 
        **functionå…³é”®å­—å£°æ˜ä¼šæ¯”varå…³é”®å­—å£°æ˜ä¼˜å…ˆçº§æ›´é«˜ã€‚**


    - Determine the value of "this" inside the context. **ç¡®å®šthisçš„æŒ‡å‘**

- **Activation / Code Execution Stage:** **æ‰§è¡Œç¯å¢ƒ-ä»£ç æ‰§è¡Œé˜¶æ®µ**
    - Run / interpret the function code in the context and assign variable values as the code is executed line by line.

### ä¸­æ–‡æ€»ç»“ï¼š

**åˆ›å»ºé˜¶æ®µ**ï¼š(ç†è§£è¿™é˜¶æ®µå¾ˆé‡è¦)
- **å»ºç«‹ä½œç”¨åŸŸé“¾**
- **åˆ›å»ºå˜é‡å¯¹è±¡**
- **ç¡®å®šthisçš„æŒ‡å‘**

**ä»£ç æ‰§è¡Œé˜¶æ®µ**ï¼šåˆ›å»ºå®Œæˆä¹‹åï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œä»£ç ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šå®Œæˆï¼š
- **å˜é‡èµ‹å€¼**
- **å‡½æ•°å¼•ç”¨**
- **æ‰§è¡Œå…¶ä»–ä»£ç **

![æ‰§è¡Œä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸ](images/æ‰§è¡Œä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸ.png) 
æ¥æºï¼š[å‰ç«¯åŸºç¡€è¿›é˜¶ï¼ˆä¸‰ï¼‰ï¼šå˜é‡å¯¹è±¡è¯¦è§£](http://www.jianshu.com/p/330b1505e41d)

----

### Letâ€™s look at an **example**:
```js
function foo(i) {
    var a = 'hello';
    var b = function privateB() {
        //dosomething
    };
    //å˜é‡båŒæ—¶ä½¿ç”¨äº†å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼ä¸¤ç§æ–¹å¼æ¥å®šä¹‰å‡½æ•°ï¼Œè¯¦æƒ…ç¬¬äº”ç« functionï¼Œp110é¡µã€‚
    function c() {

    }
}

foo(22);
```
On calling `foo(22)`, the `creation stage` looks as follows:
è°ƒç”¨å‡½æ•°foo(22)æ—¶ï¼Œåˆ›å»ºé˜¶æ®µä¸‹JSå¼•æ“ï¼š

- As you can see, the `creation stage` handles defining the names of the properties, not assigning a value to them, with the exception of formal arguments / parameters. 
**åˆ›å»ºé˜¶æ®µ**ï¼Œæœªè¿›å…¥æ‰§è¡Œé˜¶æ®µä¹‹å‰ï¼Œå˜é‡å¯¹è±¡ä¸­çš„å±æ€§éƒ½ä¸èƒ½è®¿é—®ï¼ï¼ˆå°±æ˜¯è¢«è°ƒç”¨ï¼Œä½†è¿˜æ²¡æ‰§è¡Œä»£ç ï¼‰

```js
fooExecutionContext = {   //fooå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒ

    scopeChain: { ... }, //ä½œç”¨åŸŸé“¾

    variableObject: {   //å˜é‡å¯¹è±¡
        arguments: {
            0: 22,
            length: 1
        },
        i: 22,
        c: pointer to function c()
        a: undefined,
        b: undefined    
    },  //å˜é‡båœ¨åˆ›å»ºé˜¶æ®µundefinedæ˜¯å› ä¸ºå‡½æ•°è¡¨è¾¾å¼è¿™ç§å®šä¹‰å‡½æ•°æ–¹å¼æ‰€å¼•èµ·çš„ã€‚

    this: { ... }//ç¡®å®šthisçš„æŒ‡å‘
}
```

- Once the `creation stage` has finished, the flow of execution enters the function and the activation / code `execution stage` looks like this after the function has finished execution:
è¿›å…¥æ‰§è¡Œé˜¶æ®µä¹‹åï¼Œ**å˜é‡å¯¹è±¡**è½¬å˜ä¸ºäº†**æ´»åŠ¨å¯¹è±¡ï¼ˆ`activation object`ï¼‰**ï¼Œé‡Œé¢çš„å±æ€§éƒ½èƒ½è¢«è®¿é—®äº†ï¼Œç„¶åå¼€å§‹è¿›è¡Œæ‰§è¡Œé˜¶æ®µçš„æ“ä½œã€‚

    å˜é‡å¯¹è±¡å’Œæ´»åŠ¨å¯¹è±¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»–ä»¬å…¶å®éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯å¤„äºåˆ›å»ºæ‰§è¡Œç¯å¢ƒä¸­çš„ä¸åŒé˜¶æ®µã€‚åªæœ‰å¤„äºå‡½æ•°è°ƒç”¨æ ˆæ ˆé¡¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡ï¼Œæ‰ä¼šå˜æˆæ´»åŠ¨å¯¹è±¡ã€‚ä¸‹é¢å°±æ˜¯`æ´»åŠ¨å¯¹è±¡`ï¼š


```js
fooExecutionContext = {
    scopeChain: { ... },
    variableObject: {
        arguments: {
            0: 22,
            length: 1
        },
        i: 22,
        c: pointer to function c()
        a: 'hello',
        b: pointer to function privateB()
    },
    this: { ... }
}
```

[What is the Execution Context & Stack in JavaScript?](http://davidshariff.com/blog/what-is-the-execution-context-in-javascript/) 

----

## ä¸­æ–‡ç‰ˆè§£é‡Š:åˆ›å»ºæ‰§è¡Œç¯å¢ƒ


### å˜é‡å¯¹è±¡ï¼ˆvariable objectï¼‰
æ¯ä¸ªæ‰§è¡Œç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªè¡¨ç¤ºå˜é‡çš„å¯¹è±¡â€”â€”å˜é‡å¯¹è±¡ã€‚å…¨å±€æ‰§è¡Œç¯å¢ƒçš„å˜é‡å¯¹è±¡å§‹ç»ˆå­˜åœ¨ã€‚

**å˜é‡å¯¹è±¡çš„åˆ›å»º**ï¼Œä¾æ¬¡ç»å†äº†ä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹ã€‚è¿™é‡Œæ˜¯å…¨ç¯‡ç†è§£çš„å…³é”®ï¼
- å»ºç«‹argumentså¯¹è±¡ã€‚æ£€æŸ¥å½“å‰**å‡½æ•°æ‰§è¡Œç¯å¢ƒ**ä¸­çš„å‚æ•°ï¼Œå»ºç«‹è¯¥å¯¹è±¡ä¸‹çš„å±æ€§ä¸å±æ€§å€¼ã€‚

- æ£€æŸ¥å½“å‰ä¸Šä¸‹æ–‡çš„å‡½æ•°å£°æ˜ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨**functionå…³é”®å­—å£°æ˜çš„å‡½æ•°**ã€‚åœ¨å˜é‡å¯¹è±¡ä¸­ä»¥å‡½æ•°åå»ºç«‹ä¸€ä¸ªå±æ€§ï¼Œå±æ€§å€¼ä¸ºæŒ‡å‘è¯¥å‡½æ•°æ‰€åœ¨å†…å­˜åœ°å€çš„å¼•ç”¨ã€‚å¦‚æœä¸å‡½æ•°åçš„ç›¸åŒçš„å±æ€§å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥å±æ€§å°†ä¼šè¢«æ–°çš„å¼•ç”¨æ‰€è¦†ç›–ã€‚

- æ£€æŸ¥å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å£°æ˜ï¼Œæ¯æ‰¾åˆ°ä¸€ä¸ªå˜é‡å£°æ˜ï¼Œå°±åœ¨å˜é‡å¯¹è±¡ä¸­ä»¥å˜é‡åå»ºç«‹ä¸€ä¸ªå±æ€§ï¼Œå±æ€§å€¼ä¸ºundefinedã€‚å¦‚æœè¯¥å˜é‡åçš„å±æ€§å·²ç»å­˜åœ¨ï¼Œä¸ºäº†é˜²æ­¢åŒåçš„å‡½æ•°è¢«ä¿®æ”¹ä¸ºundefinedï¼Œåˆ™ä¼šç›´æ¥è·³è¿‡ï¼ŒåŸå±æ€§å€¼ä¸ä¼šè¢«ä¿®æ”¹ã€‚

è¿™ç¯‡æ–‡ç« å°±æ˜¯æˆ‘æ‰€çœ‹åˆ°æœ€è¯¦ç»†çš„æœ‰å…³æ‰§è¡Œç¯å¢ƒå’Œå˜é‡å¯¹è±¡è®²è§£çš„æ–‡ç« ,åå¤å¤šçœ‹ã€‚



ä¸Šé¢çš„ä¸‰æ¡è§„åˆ™**ä»…ä»…é€‚ç”¨äºå˜é‡å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹**ã€‚ä¹Ÿå°±æ˜¯æ‰§è¡Œç¯å¢ƒçš„åˆ›å»ºè¿‡ç¨‹ã€‚



### å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡
ä»¥æµè§ˆå™¨ä¸­ä¸ºä¾‹ï¼Œå…¨å±€å¯¹è±¡ä¸ºwindowã€‚
å…¨å±€ä¸Šä¸‹æ–‡æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åœ°æ–¹ï¼Œå®ƒçš„å˜é‡å¯¹è±¡ï¼Œå°±æ˜¯windowå¯¹è±¡ã€‚è€Œè¿™ä¸ªç‰¹æ®Šï¼Œåœ¨thisæŒ‡å‘ä¸Šä¹ŸåŒæ ·é€‚ç”¨ï¼Œthisä¹Ÿæ˜¯æŒ‡å‘windowã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…¨å±€ä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œåªè¦ç¨‹åºè¿è¡Œä¸ç»“æŸï¼Œæ¯”å¦‚å…³æ‰æµè§ˆå™¨çª—å£ï¼Œå…¨å±€ä¸Šä¸‹æ–‡å°±ä¼šä¸€ç›´å­˜åœ¨ã€‚å…¶ä»–æ‰€æœ‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œéƒ½èƒ½ç›´æ¥è®¿é—®å…¨å±€ä¸Šä¸‹æ–‡çš„å±æ€§ã€‚
```js
// ä»¥æµè§ˆå™¨ä¸­ä¸ºä¾‹ï¼Œå…¨å±€å¯¹è±¡ä¸ºwindow
// å…¨å±€ä¸Šä¸‹æ–‡
windowEC = {
    VO: Window,
    scopeChain: {},
    this: Window
}
```

---
## æå‡(Hoisting)
æ ¹æ®**åˆ›å»ºå˜é‡å¯¹è±¡**ï¼ˆVOï¼‰çš„åˆ›é€ è¿‡ç¨‹ï¼Œå»ç†è§£å˜é‡æå‡å°±å˜å¾—ååˆ†ç®€å•äº†.
ğŸ˜³è¡¥å……

### 1. **å˜é‡å£°æ˜æå‡**(variable declaration hoisting)
åŒä¸€ä¸ªæ ‡è¯†ç¬¦çš„æƒ…å†µä¸‹(å³å˜é‡åå’Œå‡½æ•°åä¸€æ ·æ—¶)ï¼Œå˜é‡å£°æ˜ä¸å‡½æ•°å£°æ˜éƒ½ä¼šæå‡ï¼›å‡½æ•°å£°æ˜ä¼šè¦†ç›–å˜é‡å£°æ˜ï¼Œä½†ä¸ä¼šè¦†ç›–å˜é‡èµ‹å€¼ã€‚


```js
function foo() { 
    console.log('function foo'); 
}
var foo = 20;

console.log(foo); // 20
```
è¿™ä¸ªé—®é¢˜æ¶‰åŠï¼šæ¶‰åŠåˆ°å‡½æ•°å’Œå˜é‡çš„é¢„è§£æ,å‡½æ•°åå’Œå˜é‡åçš„æå‡é—®é¢˜

### 2. **å‡½æ•°å£°æ˜æå‡**(function declaration hoisting)
```js
sayHi();    //ä¸ä¼šæŠ¥é”™ï¼Œç”±äºå‡½æ•°å£°æ˜æå‡çš„ç¼˜æ•…

function sayHi() {
    console.log("Hi");
}
```