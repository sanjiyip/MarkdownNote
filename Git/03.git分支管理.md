# git分支管理

分支就是科幻电影里面的平行宇宙，当你正在电脑前努力学习Git的时候，另一个你正在另一个平行宇宙里努力学习SVN。

如果两个平行宇宙互不干扰，那对现在的你也没啥影响。不过，在某个时间点，两个平行宇宙合并了，结果，你既学会了Git又学会了SVN！

## 1. 创建与合并分支

在版本回退里，你已经知道，每次提交（`commit`），Git都把它们（`commit`）串成一条时间线，这条时间线就是一个分支（`branch`）。所以为什么 `git add .` 以后要`git commit -m "xxx"`。

截止到目前，只有一条时间线，在Git里，这个分支叫**主分支**，即`master`分支。

`HEAD`指向的版本就是当前版本，`HEAD`严格来说不是指向提交（`commit`），而是指向`master`，`master`才是指向提交（`commit`）的。

所以，`HEAD`指向的就是当前分支（`branch`）。

![主分支](images/branch01.png)

### 创建 - 切换 - 合并 - 删除分支的步骤如下：
创建 dev 分支为例

- 创建并切换到 dev 分支：`git checkout -b dev`

- 查看是否切换到 dev 分支：`git branch`

- 对 dev 分支上的内容进行修改以后，记得要 `git add .` 和 `git commit -m "xxx"`

- 切换回 master 分支：`git checkout master`

- 将 dev 分支与 master 分支合并：`git merge dev`

- 最后删除 dev 分支：`git branch -d dev`



### Git鼓励大量使用分支：

因为**创建**、**切换**、**合并**和**删除**分支非常快，所以Git鼓励你使用分支完成某个任务，合并后再删掉分支，这和直接在master分支上工作效果是一样的，但过程更安全。

1. 创建并切换分支：`git checkout -b <name>`

2. 切换分支：`git checkout <name>`

3. 合并某分支到当前分支：`git merge <name>`

4. 删除分支：`git branch -d <name>`


查看分支：`git branch`

创建分支：`git branch <name>`

---

## 2. 解决冲突（自己手动解决冲突！！！）

假设：现在这个库中两个分支，分别是 master 和 feature1

master 分支和 feature1 分支各自都分别有新的提交(commit)，变成了这样：

![解决冲突](images/解决冲突.png)

这种情况下，Git无法执行“快速合并”，只能试图把各自的修改合并起来，但这种合并就可能会有冲突，我们试试看：


当Git无法自动合并分支时，就必须首先解决冲突。（**自己手动解决冲突**）

解决冲突：是把两个文件存在差别的地方变成一致（依据最新的那个文件来）

解决冲突后，再提交（git add + git commit）、合并（git merge）完成。

用`git log --graph`命令可以看到分支合并图


---

## 3. 分支管理策略

通常，合并分支时，如果可能，Git会用`Fast forward`模式，但这种模式下，**删除分支后，会丢掉分支信息**。

如果要强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。

使用`git merge --no-ff`来禁用 Fast forward 模式。



git有个最佳实践，master是主分支，用来做正式发布版之后的保留历史，其他分支包括dev用来做正常开发，多个feature用来做某些特性功能，release用来做发布版历史，每次发布都是用release打包，hotfix用来做发布版之后的一些及时迭代修复bug的工作。


至于远程与本地的问题，先和远程服务器连起来（推上去，或者clone过来），这样库就通了（建议一个项目甚至一个分布式服务一个库，而不是一大堆项目共用一个库，git推荐这么用），然后甭管是什么操作，晚上下班前先拉取远程仓库代码，与本地代码解决冲突且合并后将当前分支推上去。拉取和推送有多种方式，具体区别请自行学习。

在实际开发中，每个开发在公司远程仓库，都有一个对应每个人自己的远程分支，每次提交时教程里面讲git push 中master参数换成对应开发人员的分支就好了，比如devloper1，控制版本上线的人比如运维人员，在远程仓库的服务器上，再选择性地把某个开发人员的分支合并进真正的master实现上线

你在远程可以建立dev分支然后开发人员把自己本地的dev分支和远程dev分支关联就好了，然后就可以往上推了。在github上你只要和远程库关联了，即使那没有dev分支，你自己建立一个dev分支，然后用git push origin dev就可以推送上去，同时远程会自动建立dev分支

工具提供的功能，都是尽量简化操作，避免冲突的。所以暂存工作区这个功能，也许有童鞋觉得不是必要。确实，如果项目小，并行工作少，并且大家都有良好的入库操作习惯的话，完全可以考人为分支操作来实现未完成工作的继续执行。但是大型项目呢？多个分支多人协作，并且在不同时间点有严格的入库要求，这时候就必须用到stash了。